<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rekapitulasi Nilai Ujian</title>
    <link href="https://fonts.googleapis.com/css?family=Poppins&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .password-prompt {
            text-align: center;
            padding: 50px;
        }
        .rekap-container {
            text-align: left;
        }
        .rekap-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .rekap-table th, .rekap-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .rekap-table th {
            background-color: #f2f2f2;
        }
        .analysis-container {
            margin-top: 40px;
        }
        .analysis-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .analysis-table th, .analysis-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="passwordSection" class="password-prompt">
            <h2>Halaman Rekapitulasi</h2>
            <p>Masukkan kata sandi untuk mengakses rekapitulasi nilai:</p>
            <input type="password" id="passwordInput">
            <button id="loginButton" class="button-primary">Masuk</button>
            <p id="errorMessage" style="color: red; margin-top: 10px; display: none;">Kata sandi salah!</p>
        </div>

        <div id="rekapSection" class="rekap-container" style="display: none;">
            <h1>Rekapitulasi Nilai Peserta Ujian</h1>
            <button id="downloadCSV" class="button-primary">Unduh CSV</button>
            
            <h2>Peringkat Peserta</h2>
            <table class="rekap-table">
                <thead>
                    <tr>
                        <th>Peringkat</th>
                        <th>Nama Peserta</th>
                        <th>Skor</th>
                        <th>Persentase</th>
                    </tr>
                </thead>
                <tbody id="rankingTableBody">
                    </tbody>
            </table>

            <div class="analysis-container">
                <h2>Analisis Butir Soal</h2>
                <table class="analysis-table">
                    <thead>
                        <tr>
                            <th>Soal</th>
                            <th>Jawaban Benar</th>
                            <th>Jawaban Salah</th>
                            <th>Persentase Benar</th>
                        </tr>
                    </thead>
                    <tbody id="analysisTableBody">
                        </tbody>
                </table>
            </div>
        </div>
    </div>
    <script src="questions.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const passwordSection = document.getElementById('passwordSection');
            const passwordInput = document.getElementById('passwordInput');
            const loginButton = document.getElementById('loginButton');
            const errorMessage = document.getElementById('errorMessage');
            const rekapSection = document.getElementById('rekapSection');
            const rankingTableBody = document.getElementById('rankingTableBody');
            const analysisTableBody = document.getElementById('analysisTableBody');
            const downloadCSVBtn = document.getElementById('downloadCSV');
            
            const ADMIN_PASSWORD = 'admin'; // Ganti dengan kata sandi yang Anda inginkan

            loginButton.addEventListener('click', () => {
                if (passwordInput.value === ADMIN_PASSWORD) {
                    passwordSection.style.display = 'none';
                    rekapSection.style.display = 'block';
                    loadRekapData();
                } else {
                    errorMessage.style.display = 'block';
                }
            });

            function loadRekapData() {
                const allResults = JSON.parse(localStorage.getItem('allUjianResults')) || [];
                const totalQuestions = questions.length;
                
                // Urutkan berdasarkan skor tertinggi
                allResults.sort((a, b) => b.skor - a.skor);

                rankingTableBody.innerHTML = '';
                allResults.forEach((result, index) => {
                    const percentage = totalQuestions > 0 ? (result.skor / totalQuestions) * 100 : 0;
                    const row = `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${result.nama}</td>
                            <td>${result.skor} / ${totalQuestions}</td>
                            <td>${percentage.toFixed(2)}%</td>
                        </tr>
                    `;
                    rankingTableBody.innerHTML += row;
                });
                
                // Analisis Butir Soal
                analysisTableBody.innerHTML = '';
                questions.forEach((q, qIndex) => {
                    let correctCount = 0;
                    let incorrectCount = 0;
                    allResults.forEach(result => {
                        const isCorrect = result.answers[qIndex] === questions[qIndex].jawabanBenar;
                        if (isCorrect) {
                            correctCount++;
                        } else if (result.answers[qIndex] !== undefined) {
                            incorrectCount++;
                        }
                    });
                    const totalAnswers = correctCount + incorrectCount;
                    const percentageCorrect = totalAnswers > 0 ? (correctCount / totalAnswers) * 100 : 0;
                    
                    const row = `
                        <tr>
                            <td>Soal ${qIndex + 1}</td>
                            <td>${correctCount}</td>
                            <td>${incorrectCount}</td>
                            <td>${percentageCorrect.toFixed(2)}%</td>
                        </tr>
                    `;
                    analysisTableBody.innerHTML += row;
                });

                downloadCSVBtn.addEventListener('click', () => {
                    let csvContent = "data:text/csv;charset=utf-8,";
                    csvContent += "Peringkat,Nama Peserta,Skor,Persentase\n";
                    allResults.forEach((result, index) => {
                        const percentage = totalQuestions > 0 ? (result.skor / totalQuestions) * 100 : 0;
                        csvContent += `${index + 1},${result.nama},${result.skor}/${totalQuestions},${percentage.toFixed(2)}%\n`;
                    });

                    const encodedUri = encodeURI(csvContent);
                    const link = document.createElement("a");
                    link.setAttribute("href", encodedUri);
                    link.setAttribute("download", "rekap-nilai-ujian.csv");
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                });
            }
        });
    </script>
</body>
</html>
